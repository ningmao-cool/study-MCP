
![é¡¹ç›®é¦–é¡µ](image/banner1.png)

# MCP å­¦ä¹ é¡¹ç›®

> ä¸€ä¸ªåŸºäº Spring Boot çš„ MCP (Model Context Protocol) å­¦ä¹ é¡¹ç›®ï¼Œæ¼”ç¤ºå·¥å…·ç¼–æ’ä¸å·¥ä½œæµæ‰§è¡Œ

## ğŸ“š æ–‡ä»¶ä¾èµ–å­¦ä¹ é¡ºåº

æŒ‰ç…§æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å­¦ä¹ ï¼Œæ¯ä¸ªæ–‡ä»¶ä¾èµ–å‰é¢çš„æ–‡ä»¶ï¼š

### ğŸ¯ å­¦ä¹ è·¯å¾„ï¼ˆ22ä¸ªæ–‡ä»¶ï¼‰

#### ğŸ“ åŸºç¡€é…ç½®æ–‡ä»¶
**1. `pom.xml`** â†’ **2. `application.yml`** â†’ **3. `McpApplication.java`**

#### ğŸ“Š æ ¸å¿ƒæ¨¡å‹æ–‡ä»¶ï¼ˆæŒ‰ä¾èµ–å…³ç³»ï¼‰
**4. `McpTool.java`** â†’ **5. `McpMessage.java`** â†’ **6. `WorkflowStep.java`** â†’ **7. `Workflow.java`** â†’ **8. `StepExecution.java`** â†’ **9. `WorkflowExecution.java`**

#### ğŸ—„ï¸ æ•°æ®è®¿é—®æ–‡ä»¶ï¼ˆæŒ‰æ¨¡å‹ä¾èµ–ï¼‰
**10. `WorkflowRepository.java`** â†’ **11. `StepExecutionRepository.java`** â†’ **12. `WorkflowExecutionRepository.java`**

#### âš™ï¸ æœåŠ¡å±‚æ–‡ä»¶ï¼ˆæŒ‰è°ƒç”¨å…³ç³»ï¼‰
**13. `McpToolExecutor.java`** â†’ **14. `FileToolExecutor.java`** â†’ **15. `SearchToolExecutor.java`** â†’ **16. `WorkflowToolExecutor.java`** â†’ **17. `McpService.java`** â†’ **18. `WorkflowExecutionService.java`**

#### ğŸŒ æ§åˆ¶å™¨æ–‡ä»¶ï¼ˆæŒ‰æœåŠ¡ä¾èµ–ï¼‰
**19. `McpController.java`** â†’ **20. `WorkflowController.java`**

#### ğŸ”§ é…ç½®å’Œå‰ç«¯
**21. `DataInitializer.java`** â†’ **22. `index.html`**

---

### ğŸ”— è¯¦ç»†ä¾èµ–å…³ç³»è¯´æ˜

```
McpTool (ç‹¬ç«‹) 
    â†“
McpMessage (ç‹¬ç«‹)
    â†“
WorkflowStep (å¼•ç”¨ StepType æšä¸¾)
    â†“
Workflow (åŒ…å« List<WorkflowStep>)
    â†“
StepExecution (å¼•ç”¨ WorkflowStep.StepType, å…³è” WorkflowExecution)
    â†“
WorkflowExecution (åŒ…å« List<StepExecution>)
    â†“
WorkflowRepository (æ“ä½œ Workflow)
    â†“
StepExecutionRepository (æ“ä½œ StepExecution)
    â†“
WorkflowExecutionRepository (æ“ä½œ WorkflowExecution)
    â†“
McpToolExecutor (æ¥å£ï¼Œå®šä¹‰å·¥å…·æ‰§è¡Œè§„èŒƒ)
    â†“
FileToolExecutor (å®ç° McpToolExecutor)
    â†“
SearchToolExecutor (å®ç° McpToolExecutor)
    â†“
WorkflowToolExecutor (å®ç° McpToolExecutor)
    â†“
McpService (èšåˆæ‰€æœ‰ McpToolExecutor)
    â†“
WorkflowExecutionService (ä½¿ç”¨ McpService + Repository)
    â†“
McpController (ä½¿ç”¨ McpService)
    â†“
WorkflowController (ä½¿ç”¨ WorkflowExecutionService)
    â†“
DataInitializer (ä½¿ç”¨ Repository åˆ›å»ºæ•°æ®)
    â†“
index.html (è°ƒç”¨ Controller API)
```

## âœ¨ ç‰¹æ€§

- ğŸ”§ **å·¥å…·æ‰§è¡Œæ¡†æ¶** - æ”¯æŒæ–‡ä»¶æ“ä½œã€ä»£ç æœç´¢ç­‰å¤šç§å·¥å…·
- ğŸ”„ **å·¥ä½œæµç¼–æ’** - å¯è§†åŒ–å·¥ä½œæµå®šä¹‰ä¸æ‰§è¡Œ
- ğŸ“Š **å®æ—¶ç›‘æ§** - æ‰§è¡ŒçŠ¶æ€è·Ÿè¸ªä¸è¿›åº¦å±•ç¤º
- ğŸ¯ **JSON-RPC æ”¯æŒ** - å…¼å®¹ MCP åè®®æ ‡å‡†
- ğŸ’¾ **æŒä¹…åŒ–å­˜å‚¨** - H2 æ•°æ®åº“å­˜å‚¨å·¥ä½œæµå®šä¹‰å’Œæ‰§è¡Œè®°å½•
- ğŸŒ **Web ç•Œé¢** - ç®€æ´ç¾è§‚çš„ç®¡ç†æ§åˆ¶å°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Java 17+
- Maven 3.6+

### è¿è¡Œé¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd study-MCP

# ç¼–è¯‘è¿è¡Œ
mvn spring-boot:run
```

### è®¿é—®åº”ç”¨

- **Web ç•Œé¢**: http://localhost:8081
- **API æ–‡æ¡£**: http://localhost:8081/api/mcp/tools
- **H2 æ§åˆ¶å°**: http://localhost:8081/h2-console

### å¿«é€Ÿä½“éªŒ

1. æ‰“å¼€ Web ç•Œé¢ï¼šhttp://localhost:8081
2. åœ¨"å·¥å…·æµ‹è¯•"åŒºåŸŸæµ‹è¯•æ–‡ä»¶åˆ›å»ºå·¥å…·
3. åœ¨"å·¥ä½œæµæ‰§è¡Œ"åŒºåŸŸæ‰§è¡Œé¢„ç½®çš„ç¤ºä¾‹å·¥ä½œæµ
4. è§‚å¯Ÿå®æ—¶æ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦

## ğŸ“‹ API æ–‡æ¡£

### å·¥å…·ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/mcp/tools` | è·å–æ‰€æœ‰å¯ç”¨å·¥å…· |
| POST | `/api/mcp/tools/{toolName}/execute` | æ‰§è¡ŒæŒ‡å®šå·¥å…· |
| POST | `/api/mcp/message` | MCP JSON-RPC æ¶ˆæ¯å¤„ç† |

### å·¥ä½œæµç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/workflows` | è·å–æ‰€æœ‰å·¥ä½œæµ |
| POST | `/api/workflows/{id}/execute` | æ‰§è¡ŒæŒ‡å®šå·¥ä½œæµ |
| GET | `/api/workflows/executions/{executionId}` | æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€ |
| GET | `/api/workflows/executions/running` | è·å–è¿è¡Œä¸­çš„æ‰§è¡Œ |

### å·¥å…·è¯´æ˜

#### 1. create_file - æ–‡ä»¶åˆ›å»ºå·¥å…·
```json
{
  "path": "example.txt",
  "content": "æ–‡ä»¶å†…å®¹"
}
```

#### 2. search_codebase - ä»£ç æœç´¢å·¥å…·
```json
{
  "query": "class",
  "fileType": "java",
  "includeDirs": ["src/main/java"],
  "excludeDirs": ["target"]
}
```

#### 3. execute_workflow - å·¥ä½œæµæ‰§è¡Œå·¥å…·
```json
{
  "workflowId": "1",
  "parameters": {}
}
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚"
        A[index.html<br/>ç”¨æˆ·ç•Œé¢]
    end
    
    subgraph "æ§åˆ¶å™¨å±‚"
        B[McpController<br/>å·¥å…·ç®¡ç†API]
        C[WorkflowController<br/>å·¥ä½œæµç®¡ç†API]
    end
    
    subgraph "æœåŠ¡å±‚"
        D[McpService<br/>å·¥å…·èšåˆç®¡ç†]
        E[WorkflowExecutionService<br/>å·¥ä½œæµæ‰§è¡Œå¼•æ“]
        F[McpToolExecutoræ¥å£<br/>å·¥å…·æ‰§è¡Œç»Ÿä¸€æ¥å£]
    end
    
    subgraph "å·¥å…·å®ç°å±‚"
        G[FileToolExecutor<br/>æ–‡ä»¶æ“ä½œå·¥å…·]
        H[SearchToolExecutor<br/>ä»£ç æœç´¢å·¥å…·]
        I[WorkflowToolExecutor<br/>å·¥ä½œæµåµŒå¥—æ‰§è¡Œ]
    end
    
    subgraph "æ•°æ®è®¿é—®å±‚"
        J[WorkflowRepository<br/>å·¥ä½œæµæ•°æ®è®¿é—®]
        K[WorkflowExecutionRepository<br/>æ‰§è¡Œè®°å½•è®¿é—®]
        L[StepExecutionRepository<br/>æ­¥éª¤è®°å½•è®¿é—®]
    end
    
    subgraph "æ•°æ®æ¨¡å‹å±‚"
        M[Workflow<br/>å·¥ä½œæµå®šä¹‰]
        N[WorkflowStep<br/>æ­¥éª¤å®šä¹‰]
        O[WorkflowExecution<br/>æ‰§è¡Œå®ä¾‹]
        P[StepExecution<br/>æ­¥éª¤æ‰§è¡Œè®°å½•]
        Q[McpTool<br/>å·¥å…·å…ƒæ•°æ®]
        R[McpMessage<br/>æ¶ˆæ¯ä¼ è¾“å¯¹è±¡]
    end
    
    subgraph "é…ç½®å±‚"
        S[DataInitializer<br/>ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–]
        T[application.yml<br/>åº”ç”¨é…ç½®]
        U[McpApplication<br/>åº”ç”¨å¯åŠ¨å…¥å£]
    end
    
    subgraph "æ•°æ®åº“"
        V[H2å†…å­˜æ•°æ®åº“]
    end
    
    A --> B
    A --> C
    B --> D
    C --> E
    D --> F
    E --> F
    F --> G
    F --> H
    F --> I
    E --> J
    E --> K
    E --> L
    J --> M
    K --> O
    L --> P
    M --> N
    O --> P
    S --> J
    U --> S
    J --> V
    K --> V
    L --> V
```


## ä¸€ã€é¡¹ç›®é…ç½®ä¸ä¾èµ–åˆ†æ

### 1.1 Mavené…ç½® (`pom.xml`)

```xml
<!-- æ ¸å¿ƒä¾èµ–é…ç½® -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.5.4</version>
</parent>

<properties>
    <java.version>17</java.version>
</properties>
```

**å…³é”®ä¾èµ–è§£æï¼š**

| ä¾èµ– | ä½œç”¨ | åœ¨é¡¹ç›®ä¸­çš„ä½“ç° |
|------|------|----------------|
| `spring-boot-starter-web` | Webåº”ç”¨åŸºç¡€ | `McpController` REST API |
| `spring-boot-starter-data-jpa` | JPAæ•°æ®è®¿é—® | Repositoryå±‚çš„æ•°æ®æŒä¹…åŒ– |
| `spring-statemachine-core` | çŠ¶æ€æœºç¼–æ’ | å·¥ä½œæµçŠ¶æ€è½¬æ¢ç®¡ç† |
| `h2` | å†…å­˜æ•°æ®åº“ | å­˜å‚¨å·¥ä½œæµå®šä¹‰å’Œæ‰§è¡Œè®°å½• |
| `spring-boot-starter-webflux` | å“åº”å¼HTTPå®¢æˆ·ç«¯ | MCPåè®®çš„HTTPé€šä¿¡ |
| `lombok` | ä»£ç ç®€åŒ– | æ‰€æœ‰modelç±»çš„æ³¨è§£ |

### 1.2 åº”ç”¨é…ç½® (`application.yml`)

```yaml
# æ ¸å¿ƒé…ç½®
server:
  port: 8081  # WebæœåŠ¡ç«¯å£

spring:
  datasource:
    url: jdbc:h2:mem:mcplearning  # H2å†…å­˜æ•°æ®åº“
    driver-class-name: org.h2.Driver
  
  jpa:
    hibernate:
      ddl-auto: create-drop  # æ¯æ¬¡å¯åŠ¨é‡å»ºè¡¨ç»“æ„
    show-sql: true  # æ˜¾ç¤ºSQLè¯­å¥ï¼Œä¾¿äºè°ƒè¯•

# è‡ªå®šä¹‰MCPé…ç½®
mcp:
  server:
    host: localhost
    port: 3000
    timeout: 30000
  workflow:
    max-retries: 3
    retry-delay: 1000
```

## äºŒã€æ•°æ®æ¨¡å‹å±‚è¯¦ç»†åˆ†æ

### 2.1 æ ¸å¿ƒå®ä½“å…³ç³»

```mermaid
erDiagram
    Workflow ||--o{ WorkflowStep : contains
    Workflow ||--o{ WorkflowExecution : "creates instances"
    WorkflowExecution ||--o{ StepExecution : "tracks step progress"
    
    Workflow {
        Long id PK
        String name
        String description
        String version
        WorkflowStatus status
        String parameters
        String config
        LocalDateTime createdAt
        LocalDateTime updatedAt
        String createdBy
    }
    
    WorkflowStep {
        Long id PK
        String name
        String description
        StepType type
        Integer orderIndex
        StepStatus status
        String toolName
        String parameters
        String config
        String condition
        Integer maxRetries
        Long retryDelay
        Long timeout
        Long workflow_id FK
    }
    
    WorkflowExecution {
        Long id PK
        String executionId
        Long workflowId FK
        ExecutionStatus status
        String parameters
        String result
        String errorMessage
        Integer currentStepIndex
        Integer completedSteps
        Integer totalSteps
        LocalDateTime startedAt
        LocalDateTime completedAt
        Long duration
        String executedBy
    }
    
    StepExecution {
        Long id PK
        String stepName
        StepType stepType
        ExecutionStatus status
        Integer orderIndex
        String inputParameters
        String outputResult
        String errorMessage
        LocalDateTime startedAt
        LocalDateTime completedAt
        Long duration
        Integer retryCount
        String toolName
        String executionLog
        Long execution_id FK
    }
```
### 2.2 æ¨¡å‹ç±»è¯¦ç»†è§£æ

#### `Workflow.java` - å·¥ä½œæµå®šä¹‰
```java
@Entity
@Table(name = "workflows")
public class Workflow {
    // å·¥ä½œæµå…ƒä¿¡æ¯
    private String name;        // å·¥ä½œæµåç§°
    private String description; // å·¥ä½œæµæè¿°
    private String version;     // ç‰ˆæœ¬å·
    
    // å·¥ä½œæµçŠ¶æ€ï¼šDRAFT, ACTIVE, INACTIVE, DEPRECATED
    private WorkflowStatus status;
    
    // æ­¥éª¤å®šä¹‰ - ä½¿ç”¨ @JsonManagedReference é¿å…å¾ªç¯åºåˆ—åŒ–
    @OneToMany(mappedBy = "workflow", cascade = CascadeType.ALL, fetch = FetchType.EAGER)
    @JsonManagedReference
    private List<WorkflowStep> steps;
}
```

**å…³é”®è®¾è®¡ç‚¹ï¼š**
- ä½¿ç”¨ `@JsonManagedReference` å’Œ `@JsonBackReference` è§£å†³JSONåºåˆ—åŒ–å¾ªç¯å¼•ç”¨
- `fetch = FetchType.EAGER` ç¡®ä¿åŠ è½½å·¥ä½œæµæ—¶åŒæ—¶åŠ è½½æ‰€æœ‰æ­¥éª¤
- `cascade = CascadeType.ALL` ç¡®ä¿å·¥ä½œæµåˆ é™¤æ—¶æ­¥éª¤ä¸€å¹¶åˆ é™¤

#### `WorkflowStep.java` - æ­¥éª¤å®šä¹‰
```java
public enum StepType {
    TOOL,       // å·¥å…·æ­¥éª¤ - è°ƒç”¨å…·ä½“å·¥å…·
    CONDITION,  // æ¡ä»¶æ­¥éª¤ - åŸºäºå‰ç½®æ­¥éª¤ç»“æœåˆ¤æ–­
    LOOP,       // å¾ªç¯æ­¥éª¤ - æš‚æœªå®ç°
    PARALLEL,   // å¹¶è¡Œæ­¥éª¤ - æš‚æœªå®ç°
    DELAY,      // å»¶è¿Ÿæ­¥éª¤ - ç­‰å¾…æŒ‡å®šæ—¶é—´
    CUSTOM      // è‡ªå®šä¹‰æ­¥éª¤ - æ‰©å±•ç”¨
}
```

**æ­¥éª¤ç±»å‹è¯´æ˜ï¼š**
- `TOOL`: æœ€æ ¸å¿ƒçš„æ­¥éª¤ç±»å‹ï¼Œé€šè¿‡ `toolName` å­—æ®µæŒ‡å®šè¦æ‰§è¡Œçš„å·¥å…·
- `CONDITION`: æ¡ä»¶åˆ¤æ–­ï¼Œä½¿ç”¨ `condition` å­—æ®µå­˜å‚¨è¡¨è¾¾å¼å¦‚ `"resultCount > 0"`
- `DELAY`: å»¶è¿Ÿæ‰§è¡Œï¼Œåœ¨ `config` ä¸­é…ç½®å»¶è¿Ÿæ—¶é—´

#### `WorkflowExecution.java` - æ‰§è¡Œå®ä¾‹
```java
// å…³é”®å­—æ®µè§£æ
private String executionId;    // UUIDï¼Œå”¯ä¸€æ ‡è¯†ä¸€æ¬¡æ‰§è¡Œ
private Integer currentStepIndex;   // å½“å‰æ‰§è¡Œåˆ°ç¬¬å‡ æ­¥
private Integer completedSteps;     // å·²å®Œæˆæ­¥éª¤æ•°
private Integer totalSteps;         // æ€»æ­¥éª¤æ•°

// è®¡ç®—æ‰§è¡Œè¿›åº¦çš„æ–¹æ³•
public double getProgress() {
    if (totalSteps == 0) return 0.0;
    return (double) completedSteps / totalSteps * 100.0;
}
```

**è®¾è®¡äº®ç‚¹ï¼š**
- ä½¿ç”¨ `@JsonIgnore` é¿å…åºåˆ—åŒ– `stepExecutions` é›†åˆï¼Œé˜²æ­¢è¿”å›æ•°æ®è¿‡å¤§
- æä¾›è¿›åº¦è®¡ç®—æ–¹æ³•ï¼Œä¾¿äºå‰ç«¯å±•ç¤ºè¿›åº¦æ¡
- ä½¿ç”¨ `@PreUpdate` è‡ªåŠ¨è®¡ç®—æ‰§è¡Œæ—¶é•¿

#### `McpTool.java` - å·¥å…·å…ƒæ•°æ®
```java
// è¾“å…¥å‚æ•°æ¨¡å¼ - ç±»ä¼¼JSON Schema
private Map<String, Object> inputSchema;

// ç¤ºä¾‹ï¼šæ–‡ä»¶å·¥å…·çš„è¾“å…¥æ¨¡å¼
{
    "type": "object",
    "properties": {
        "path": {"type": "string", "description": "æ–‡ä»¶è·¯å¾„"},
        "content": {"type": "string", "description": "æ–‡ä»¶å†…å®¹"}
    },
    "required": ["path", "content"]
}
```

**ä½œç”¨è¯´æ˜ï¼š**
- ä¸ºå‰ç«¯æä¾›å·¥å…·çš„å…ƒä¿¡æ¯å±•ç¤º
- `inputSchema` å®šä¹‰å·¥å…·æ‰€éœ€çš„è¾“å…¥å‚æ•°ç»“æ„
- é™æ€å·¥å‚æ–¹æ³•å¦‚ `createFileTool()` ä¾¿äºåˆ›å»ºé¢„å®šä¹‰å·¥å…·

#### `McpMessage.java` - JSON-RPCåè®®æ¶ˆæ¯
```java
// JSON-RPC 2.0 æ ‡å‡†æ ¼å¼
private String jsonrpc = "2.0";    // åè®®ç‰ˆæœ¬
private String id;                 // è¯·æ±‚ID
private String method;             // æ–¹æ³•å
private Map<String, Object> params; // å‚æ•°
private Object result;             // å“åº”ç»“æœ
private McpError error;            // é”™è¯¯ä¿¡æ¯
```

## ä¸‰ã€æ•°æ®è®¿é—®å±‚ (Repository)

### 3.1 Repositoryæ¥å£è®¾è®¡

æ‰€æœ‰Repositoryéƒ½ç»§æ‰¿ `JpaRepository<Entity, ID>`ï¼Œæä¾›åŸºç¡€CRUDæ“ä½œã€‚

#### `WorkflowRepository.java`
```java
// æ ¸å¿ƒæŸ¥è¯¢æ–¹æ³•
List<Workflow> findByStatus(Workflow.WorkflowStatus status);
List<Workflow> findByCreatedBy(String createdBy);
List<Workflow> findByNameContainingIgnoreCase(String name);

@Query("SELECT w FROM Workflow w WHERE w.status = 'ACTIVE'")
List<Workflow> findActiveWorkflows();
```

#### `WorkflowExecutionRepository.java`
```java
// å…³é”®æŸ¥è¯¢åŠŸèƒ½
Optional<WorkflowExecution> findByExecutionId(String executionId);
List<WorkflowExecution> findByWorkflowIdOrderByStartedAtDesc(Long workflowId, Pageable pageable);

@Query("SELECT e FROM WorkflowExecution e WHERE e.status = 'RUNNING'")
List<WorkflowExecution> findRunningExecutions();

@Query("SELECT e.status, COUNT(e) FROM WorkflowExecution e GROUP BY e.status")
List<Object[]> countByStatus();  // ç»Ÿè®¡å„çŠ¶æ€çš„æ‰§è¡Œæ•°é‡
```

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨ `Optional<>` å¤„ç†å¯èƒ½ä¸ºç©ºçš„æŸ¥è¯¢ç»“æœ
- æä¾›åˆ†é¡µæŸ¥è¯¢æ”¯æŒï¼ˆ`Pageable`ï¼‰
- è‡ªå®šä¹‰ç»Ÿè®¡æŸ¥è¯¢ä¾¿äºç›‘æ§ç³»ç»ŸçŠ¶æ€

## å››ã€ä¸šåŠ¡é€»è¾‘å±‚ (Service)

### 4.1 å·¥å…·æ‰§è¡Œæ¡†æ¶

#### `McpToolExecutor` æ¥å£
```java
public interface McpToolExecutor {
    String getToolName();                    // å·¥å…·åç§°
    String getToolDescription();             // å·¥å…·æè¿°
    McpTool getToolModel();                 // å·¥å…·å…ƒæ•°æ®
    ToolExecutionResult execute(Map<String, Object> parameters);  // æ‰§è¡Œå·¥å…·
    boolean validateParameters(Map<String, Object> parameters);   // å‚æ•°éªŒè¯
    
    // ç»Ÿä¸€çš„æ‰§è¡Œç»“æœå°è£…
    class ToolExecutionResult {
        private final boolean success;       // æ˜¯å¦æˆåŠŸ
        private final Object result;         // ç»“æœæ•°æ®
        private final String errorMessage;   // é”™è¯¯ä¿¡æ¯
        private final long executionTime;    // æ‰§è¡Œè€—æ—¶(æ¯«ç§’)
    }
}
```

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- ç»Ÿä¸€çš„æ¥å£è§„èŒƒï¼Œæ‰€æœ‰å·¥å…·å®ç°ä¿æŒä¸€è‡´
- ç»“æœå°è£…åŒ…å«æˆåŠŸæ ‡å¿—ã€ç»“æœæ•°æ®ã€é”™è¯¯ä¿¡æ¯ã€æ‰§è¡Œæ—¶é—´
- æ”¯æŒå‚æ•°éªŒè¯ï¼Œæå‡ç³»ç»Ÿå¥å£®æ€§

#### `McpService` - å·¥å…·èšåˆæœåŠ¡
```java
@Service
public class McpService {
    private final Map<String, McpToolExecutor> toolExecutors = new ConcurrentHashMap<>();
    
    @Autowired
    public McpService(List<McpToolExecutor> executors) {
        // å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œæ‰€æœ‰å·¥å…·æ‰§è¡Œå™¨
        for (McpToolExecutor executor : executors) {
            toolExecutors.put(executor.getToolName(), executor);
        }
    }
}
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- è‡ªåŠ¨å‘ç°å¹¶æ³¨å†Œæ‰€æœ‰ `McpToolExecutor` å®ç°ç±»
- æä¾›å·¥å…·åˆ—è¡¨æŸ¥è¯¢ã€å·¥å…·æ‰§è¡Œã€JSON-RPCæ¶ˆæ¯å¤„ç†
- ä½¿ç”¨ `ConcurrentHashMap` ä¿è¯çº¿ç¨‹å®‰å…¨

### 4.2 å·¥å…·å®ç°è¯¦è§£

#### `FileToolExecutor` - æ–‡ä»¶æ“ä½œå·¥å…·
```java
@Override
public ToolExecutionResult execute(Map<String, Object> parameters) {
    String path = (String) parameters.get("path");
    String content = (String) parameters.get("content");
    
    // åˆ›å»ºæ–‡ä»¶è·¯å¾„ï¼Œç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨
    Path filePath = Paths.get(path);
    Path parentDir = filePath.getParent();
    if (parentDir != null && !Files.exists(parentDir)) {
        Files.createDirectories(parentDir);
    }
    
    // å†™å…¥æ–‡ä»¶
    Files.write(filePath, content.getBytes(), 
                StandardOpenOption.CREATE, StandardOpenOption.TRUNCATE_EXISTING);
    
    return ToolExecutionResult.success(Map.of(
        "path", path,
        "size", content.length(),
        "created", true
    ), executionTime);
}
```

**å®ç°äº®ç‚¹ï¼š**
- è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•ï¼Œé¿å…æ–‡ä»¶åˆ›å»ºå¤±è´¥
- ä½¿ç”¨ `StandardOpenOption` ç¡®ä¿æ–‡ä»¶åˆ›å»ºæˆ–è¦†ç›–
- è¿”å›è¯¦ç»†çš„æ‰§è¡Œç»“æœï¼ˆè·¯å¾„ã€å¤§å°ã€çŠ¶æ€ï¼‰

#### `SearchToolExecutor` - ä»£ç æœç´¢å·¥å…·
```java
// æ”¯æŒçš„æœç´¢å‚æ•°
{
    "query": "class",                    // æœç´¢å…³é”®è¯
    "fileType": "java,kt",              // æ–‡ä»¶ç±»å‹ï¼ˆæ”¯æŒå¤šæ‰©å±•åï¼‰
    "includeDirs": ["src/main/java"],   // åŒ…å«ç›®å½•
    "excludeDirs": ["target", ".git"]   // æ’é™¤ç›®å½•
}

// æ ¸å¿ƒæœç´¢é€»è¾‘
private List<SearchResult> performSearch(String query, String fileType, 
                                       List<String> includeDirs, Set<String> extraExcludedDirs) {
    PathMatcher fileMatcher = buildFileMatcher(fileType);
    
    Files.walkFileTree(searchDir, new SimpleFileVisitor<Path>() {
        @Override
        public FileVisitResult preVisitDirectory(Path dir, BasicFileAttributes attrs) {
            // è·³è¿‡æ’é™¤çš„ç›®å½•ï¼ˆ.git, target, node_modulesç­‰ï¼‰
            if (shouldExcludeDirectory(dir)) {
                return FileVisitResult.SKIP_SUBTREE;
            }
            return FileVisitResult.CONTINUE;
        }
        
        @Override
        public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {
            // æ–‡ä»¶ç±»å‹è¿‡æ»¤ + å†…å®¹æœç´¢
            if (fileMatcher != null && !fileMatcher.matches(file.getFileName())) {
                return FileVisitResult.CONTINUE;
            }
            List<SearchMatch> matches = searchInFile(file, query);
            if (!matches.isEmpty()) {
                results.add(new SearchResult(file.toString(), matches));
            }
            return FileVisitResult.CONTINUE;
        }
    });
}
```

**ç‰¹è‰²åŠŸèƒ½ï¼š**
- æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢ï¼Œå¤§å°å†™ä¸æ•æ„Ÿ
- æ™ºèƒ½æ–‡ä»¶ç±»å‹è¿‡æ»¤ï¼ˆæ”¯æŒ `*.java` æˆ– `java,kt` æ ¼å¼ï¼‰
- é¢„è®¾æ’é™¤ç›®å½•ï¼ˆ`.git`, `target`, `node_modules` ç­‰ï¼‰
- è¿”å›åŒ¹é…çš„è¡Œå·å’Œå†…å®¹

### 4.3 å·¥ä½œæµæ‰§è¡Œå¼•æ“

#### `WorkflowExecutionService` - æ ¸å¿ƒæ‰§è¡ŒæœåŠ¡

```java
@Transactional
public WorkflowExecution startWorkflow(String workflowId, Map<String, Object> parameters, String executedBy) {
    // 1. éªŒè¯å·¥ä½œæµå­˜åœ¨ä¸”çŠ¶æ€ä¸ºACTIVE
    Workflow workflow = workflowRepository.findById(Long.valueOf(workflowId))
            .orElseThrow(() -> new IllegalArgumentException("å·¥ä½œæµä¸å­˜åœ¨"));
    
    // 2. åˆ›å»ºæ‰§è¡Œå®ä¾‹
    WorkflowExecution execution = WorkflowExecution.builder()
            .executionId(UUID.randomUUID().toString())
            .workflowId(workflow.getId())
            .status(WorkflowExecution.ExecutionStatus.PENDING)
            .totalSteps(workflow.getSteps().size())
            .build();
    
    // 3. ä¿å­˜æ‰§è¡Œå®ä¾‹
    execution = executionRepository.save(execution);
    
    // 4. äº‹åŠ¡æäº¤åå¼‚æ­¥å¯åŠ¨æ‰§è¡Œ
    TransactionSynchronizationManager.registerSynchronization(new TransactionSynchronization() {
        @Override
        public void afterCommit() {
            CompletableFuture.runAsync(() -> executeWorkflow(executionId, workflowId));
        }
    });
    
    return execution;
}
```

**å…³é”®è®¾è®¡ï¼š**
- ä½¿ç”¨ `TransactionSynchronization.afterCommit()` ç¡®ä¿å¼‚æ­¥æ‰§è¡Œåœ¨äº‹åŠ¡æäº¤åå¼€å§‹
- é¿å…è¯»å–æœªæäº¤çš„æ•°æ®å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜
- è¿”å›æ‰§è¡Œå®ä¾‹ä¾›å‰ç«¯è½®è¯¢çŠ¶æ€

#### æ­¥éª¤æ‰§è¡Œé€»è¾‘
```java
private boolean executeStep(WorkflowExecution execution, WorkflowStep step) {
    switch (step.getType()) {
        case TOOL:
            return executeToolStep(stepExecution, step);
        case CONDITION:
            return executeConditionStep(stepExecution, step);
        case DELAY:
            return executeDelayStep(stepExecution, step);
        default:
            return false;
    }
}

// å·¥å…·æ­¥éª¤æ‰§è¡Œ
private boolean executeToolStep(StepExecution stepExecution, WorkflowStep step) {
    // 1. è§£ææ­¥éª¤å‚æ•°
    Map<String, Object> parameters = parseParameters(step.getParameters());
    
    // 2. åˆå¹¶æ‰§è¡Œçº§å‚æ•°ï¼ˆå¯è¦†ç›–æ­¥éª¤å‚æ•°ï¼‰
    Map<String, Object> execParams = parseParameters(stepExecution.getExecution().getParameters());
    if (execParams != null) {
        parameters.putAll(execParams);
    }
    
    // 3. æ‰§è¡Œå·¥å…·
    McpToolExecutor.ToolExecutionResult result = mcpService.getToolExecutor(step.getToolName()).execute(parameters);
    
    // 4. è®°å½•è¾“å…¥è¾“å‡ºï¼ˆä½¿ç”¨ObjectMapperåºåˆ—åŒ–JSONï¼‰
    stepExecution.setInputParameters(new ObjectMapper().writeValueAsString(parameters));
    stepExecution.setOutputResult(new ObjectMapper().writeValueAsString(result.getResult()));
    
    return result.isSuccess();
}

// æ¡ä»¶æ­¥éª¤æ‰§è¡Œ
private boolean executeConditionStep(StepExecution stepExecution, WorkflowStep step) {
    // è·å–ä¸Šä¸€ä¸ªå®Œæˆæ­¥éª¤çš„è¾“å‡º
    List<StepExecution> steps = stepExecutionRepository.findByExecution(stepExecution.getExecution());
    StepExecution prevCompleted = steps.stream()
            .filter(s -> s.getStatus() == StepExecution.ExecutionStatus.COMPLETED)
            .max(Comparator.comparing(StepExecution::getOrderIndex))
            .orElse(null);
    
    // è§£æç»“æœæ•°é‡
    int resultCount = 0;
    if (prevCompleted != null) {
        resultCount = extractTotalCountFromOutput(prevCompleted.getOutputResult());
    }
    
    // è¯„ä¼°æ¡ä»¶è¡¨è¾¾å¼ï¼ˆæ”¯æŒ resultCount > 0 ç­‰ç®€å•è¡¨è¾¾å¼ï¼‰
    return evaluateCondition(step.getCondition(), resultCount);
}
```

**æ¡ä»¶è¡¨è¾¾å¼æ”¯æŒï¼š**
```java
// æ”¯æŒçš„æ¡ä»¶æ ¼å¼
"resultCount > 0"     // ç»“æœæ•°é‡å¤§äº0
"resultCount >= 5"    // ç»“æœæ•°é‡å¤§äºç­‰äº5
"resultCount == 0"    // ç»“æœæ•°é‡ç­‰äº0
"resultCount < 10"    // ç»“æœæ•°é‡å°äº10
```

## äº”ã€æ§åˆ¶å™¨å±‚ (Controller)

### `McpController.java` - REST APIæ§åˆ¶å™¨

```java
@RestController
@RequestMapping("/api/mcp")
@CrossOrigin(origins = "*")
public class McpController {
    
    // è·å–æ‰€æœ‰å¯ç”¨å·¥å…·
    @GetMapping("/tools")
    public ResponseEntity<List<McpTool>> listTools();
    
    // æ‰§è¡ŒæŒ‡å®šå·¥å…·
    @PostMapping("/tools/{toolName}/execute")
    public ResponseEntity<Map<String, Object>> executeTool(
            @PathVariable String toolName,
            @RequestBody Map<String, Object> parameters);
    
    // å…¼å®¹MCP JSON-RPCåè®®
    @PostMapping("/message")
    public ResponseEntity<McpMessage> handleMessage(@RequestBody McpMessage message);
    
    // ç³»ç»ŸçŠ¶æ€æŸ¥è¯¢
    @GetMapping("/status")
    public ResponseEntity<Map<String, Object>> getStatus();
}
```

**APIè¿”å›æ ¼å¼ç»Ÿä¸€ï¼š**
```json
// å·¥å…·æ‰§è¡Œå“åº”
{
    "success": true,
    "executionTime": 150,
    "result": {
        "path": "test.txt",
        "size": 25,
        "created": true
    }
}

// é”™è¯¯å“åº”
{
    "success": false,
    "executionTime": 50,
    "errorMessage": "å‚æ•°éªŒè¯å¤±è´¥"
}
```

## å…­ã€é…ç½®ä¸åˆå§‹åŒ–

### `DataInitializer.java` - ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–

å®ç° `CommandLineRunner` æ¥å£ï¼Œåœ¨åº”ç”¨å¯åŠ¨åè‡ªåŠ¨åˆå§‹åŒ–ç¤ºä¾‹å·¥ä½œæµï¼š

#### ç¤ºä¾‹å·¥ä½œæµ1ï¼šæ–‡ä»¶å¤„ç†å·¥ä½œæµ
```java
Workflow fileProcessingWorkflow = Workflow.builder()
    .name("æ–‡ä»¶å¤„ç†å·¥ä½œæµ")
    .steps(Arrays.asList(
        // æ­¥éª¤1ï¼šåˆ›å»ºæ–‡ä»¶
        WorkflowStep.builder()
            .name("åˆ›å»ºç¤ºä¾‹æ–‡ä»¶")
            .type(StepType.TOOL)
            .toolName("create_file")
            .parameters("{\"path\": \"sample.txt\", \"content\": \"ç¤ºä¾‹å†…å®¹\"}")
            .orderIndex(1)
            .build(),
        // æ­¥éª¤2ï¼šå»¶è¿Ÿ2ç§’
        WorkflowStep.createDelayStep("ç­‰å¾…å¤„ç†", 2000L, 2),
        // æ­¥éª¤3ï¼šæœç´¢åˆšåˆ›å»ºçš„æ–‡ä»¶
        WorkflowStep.builder()
            .name("æœç´¢æ–‡ä»¶å†…å®¹")
            .type(StepType.TOOL)
            .toolName("search_codebase")
            .parameters("{\"query\": \"ç¤ºä¾‹æ–‡ä»¶\", \"fileType\": \"txt\", \"includeDirs\": [\".\"]}")
            .orderIndex(3)
            .build()
    ))
    .build();
```

#### ç¤ºä¾‹å·¥ä½œæµ2ï¼šä»£ç æœç´¢å·¥ä½œæµ
```java
Workflow searchWorkflow = Workflow.builder()
    .name("ä»£ç æœç´¢å·¥ä½œæµ")
    .steps(Arrays.asList(
        // æ­¥éª¤1ï¼šæœç´¢Javaæ–‡ä»¶ä¸­çš„classå…³é”®è¯
        WorkflowStep.builder()
            .name("æœç´¢Javaæ–‡ä»¶")
            .type(StepType.TOOL)
            .toolName("search_codebase")
            .parameters("{\"query\": \"class\", \"fileType\": \"java\"}")
            .orderIndex(1)
            .build(),
        // æ­¥éª¤2ï¼šæ¡ä»¶åˆ¤æ–­ - å¦‚æœæœç´¢ç»“æœå¤§äº0ç»§ç»­
        WorkflowStep.createConditionStep("æ£€æŸ¥æœç´¢ç»“æœ", "resultCount > 0", 2),
        // æ­¥éª¤3ï¼šå»¶è¿Ÿ1ç§’
        WorkflowStep.createDelayStep("å¤„ç†å»¶è¿Ÿ", 1000L, 3)
    ))
    .build();
```

## ä¸ƒã€å‰ç«¯é¡µé¢åˆ†æ

### `index.html` - å•é¡µé¢åº”ç”¨

å‰ç«¯é‡‡ç”¨åŸç”ŸJavaScript + CSSï¼Œæä¾›å®Œæ•´çš„å·¥å…·å’Œå·¥ä½œæµç®¡ç†ç•Œé¢ï¼š

#### åŠŸèƒ½æ¨¡å—
1. **å·¥å…·ç®¡ç†**
   - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å·¥å…·
   - æä¾›æ–‡ä»¶å·¥å…·å’Œæœç´¢å·¥å…·çš„å‚æ•°è¾“å…¥ç•Œé¢
   - å®æ—¶æ˜¾ç¤ºå·¥å…·æ‰§è¡Œç»“æœ

2. **å·¥ä½œæµç®¡ç†**
   - æ˜¾ç¤ºæ‰€æœ‰å·¥ä½œæµåˆ—è¡¨
   - é€‰æ‹©å¹¶æ‰§è¡Œå·¥ä½œæµ
   - æŸ¥çœ‹è¿è¡Œä¸­çš„æ‰§è¡Œå®ä¾‹

3. **æ‰§è¡Œç›‘æ§**
   - å®æ—¶æ˜¾ç¤ºæ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦
   - è¿›åº¦æ¡å¯è§†åŒ–æ˜¾ç¤º
   - æ‰§è¡Œæ—¥å¿—è®°å½•

#### å…³é”®JavaScriptå‡½æ•°
```javascript
// å·¥å…·æ‰§è¡Œ
async function testFileTool() {
    const response = await fetch('/api/mcp/tools/create_file/execute', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            path: filePath, 
            content: fileContent 
        })
    });
}

// å·¥ä½œæµæ‰§è¡Œ
async function executeWorkflow() {
    const response = await fetch(`/api/workflows/${workflowId}/execute`, {
        method: 'POST',
        body: JSON.stringify({
            parameters: {},
            executedBy: 'web-user'
        })
    });
    
    // å¼€å§‹çŠ¶æ€ç›‘æ§
    startStatusMonitoring(execution.executionId);
}

// çŠ¶æ€ç›‘æ§
function startStatusMonitoring(executionId) {
    statusCheckInterval = setInterval(async () => {
        const response = await fetch(`/api/workflows/executions/${executionId}`);
        const execution = await response.json();
        
        // æ›´æ–°è¿›åº¦æ¡
        const progressPercent = (execution.completedSteps / execution.totalSteps) * 100;
        progressBar.style.width = `${progressPercent}%`;
        
        // æ‰§è¡Œå®Œæˆåˆ™åœæ­¢ç›‘æ§
        if (execution.status === 'COMPLETED' || execution.status === 'FAILED') {
            clearInterval(statusCheckInterval);
        }
    }, 2000);
}
```

## å…«ã€é¡¹ç›®æ‰§è¡Œæµç¨‹è¯¦è§£

### 8.1 å·¥å…·æ‰§è¡Œæµç¨‹
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·/å‰ç«¯
    participant C as McpController
    participant S as McpService
    participant E as å·¥å…·æ‰§è¡Œå™¨
    participant F as æ–‡ä»¶ç³»ç»Ÿ
    
    U->>C: POST /api/mcp/tools/create_file/execute
    C->>S: getToolExecutor("create_file")
    S->>C: è¿”å›FileToolExecutor
    C->>E: execute(parameters)
    E->>E: validateParameters()
    E->>F: åˆ›å»ºæ–‡ä»¶ç›®å½•
    E->>F: å†™å…¥æ–‡ä»¶å†…å®¹
    F->>E: è¿”å›å†™å…¥ç»“æœ
    E->>C: ToolExecutionResult(success, result, time)
    C->>U: è¿”å›ç»Ÿä¸€æ ¼å¼å“åº”
```
### 8.2 å·¥ä½œæµæ‰§è¡Œæµç¨‹
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·/å‰ç«¯
    participant C as æ§åˆ¶å™¨
    participant WS as WorkflowExecutionService
    participant DB as æ•°æ®åº“
    participant TS as å·¥å…·æœåŠ¡
    
    U->>C: POST /api/workflows/{id}/execute
    C->>WS: startWorkflow(id, params, user)
    WS->>DB: æŸ¥è¯¢å·¥ä½œæµå®šä¹‰
    DB->>WS: è¿”å›å·¥ä½œæµå’Œæ­¥éª¤
    WS->>DB: åˆ›å»ºWorkflowExecutionè®°å½•
    WS->>WS: æ³¨å†Œäº‹åŠ¡æäº¤åå›è°ƒ
    WS->>C: è¿”å›æ‰§è¡Œå®ä¾‹
    C->>U: è¿”å›executionId
    
    Note over WS: äº‹åŠ¡æäº¤åå¼‚æ­¥æ‰§è¡Œ
    WS->>WS: executeWorkflow(å¼‚æ­¥)
    WS->>DB: æ›´æ–°çŠ¶æ€ä¸ºRUNNING
    
    loop éå†æ¯ä¸ªæ­¥éª¤
        WS->>DB: åˆ›å»ºStepExecutionè®°å½•
        alt å·¥å…·æ­¥éª¤
            WS->>TS: æ‰§è¡Œå·¥å…·
            TS->>WS: è¿”å›æ‰§è¡Œç»“æœ
        else æ¡ä»¶æ­¥éª¤
            WS->>DB: æŸ¥è¯¢ä¸Šä¸€æ­¥è¾“å‡º
            WS->>WS: è¯„ä¼°æ¡ä»¶è¡¨è¾¾å¼
        else å»¶è¿Ÿæ­¥éª¤
            WS->>WS: Thread.sleep(delayMs)
        end
        WS->>DB: æ›´æ–°æ­¥éª¤æ‰§è¡ŒçŠ¶æ€
        WS->>DB: æ›´æ–°å·¥ä½œæµè¿›åº¦
    end
    
    WS->>DB: æ›´æ–°æœ€ç»ˆçŠ¶æ€ä¸ºCOMPLETED/FAILED
    
    Note over U: å‰ç«¯è½®è¯¢çŠ¶æ€
    U->>C: GET /api/workflows/executions/{id}
    C->>DB: æŸ¥è¯¢æ‰§è¡ŒçŠ¶æ€
    DB->>C: è¿”å›çŠ¶æ€å’Œè¿›åº¦
    C->>U: è¿”å›çŠ¶æ€ä¿¡æ¯
```
## ä¹ã€å…³é”®æŠ€æœ¯ç‚¹å’Œæœ€ä½³å®è·µ

### 9.1 JSONåºåˆ—åŒ–å¾ªç¯å¼•ç”¨å¤„ç†
```java
// Workflow ä¸­ä½¿ç”¨ @JsonManagedReference
@OneToMany(mappedBy = "workflow")
@JsonManagedReference
private List<WorkflowStep> steps;

// WorkflowStep ä¸­ä½¿ç”¨ @JsonBackReference
@ManyToOne
@JsonBackReference
private Workflow workflow;

// WorkflowExecution ä¸­ä½¿ç”¨ @JsonIgnore
@OneToMany(mappedBy = "execution")
@JsonIgnore
private List<StepExecution> stepExecutions;
```

### 9.2 å¼‚æ­¥æ‰§è¡Œçš„äº‹åŠ¡å®‰å…¨
```java
// ç¡®ä¿åœ¨äº‹åŠ¡æäº¤åå†å¯åŠ¨å¼‚æ­¥ä»»åŠ¡
TransactionSynchronizationManager.registerSynchronization(new TransactionSynchronization() {
    @Override
    public void afterCommit() {
        CompletableFuture.runAsync(() -> executeWorkflow(executionId, workflowId));
    }
});
```

### 9.3 å‚æ•°å®‰å…¨è§£æ
```java
// ä½¿ç”¨ObjectMapperå®‰å…¨è§£æJSONå‚æ•°
private Map<String, Object> parseParameters(String parameters) {
    if (parameters == null || parameters.trim().isEmpty()) {
        return new HashMap<>();
    }
    try {
        return new ObjectMapper().readValue(parameters, Map.class);
    } catch (Exception e) {
        log.warn("å‚æ•°è§£æå¤±è´¥: {}", parameters, e);
        return new HashMap<>();
    }
}
```

### 9.4 è¿›åº¦ç›‘æ§å’ŒçŠ¶æ€ç®¡ç†
```java
// æä¾›å®æ—¶è¿›åº¦è®¡ç®—
public double getProgress() {
    if (totalSteps == 0) return 0.0;
    return (double) completedSteps / totalSteps * 100.0;
}

// å‰ç«¯è½®è¯¢æœºåˆ¶
setInterval(async () => {
    const execution = await fetchExecutionStatus(executionId);
    updateProgressBar(execution.progress);
    if (execution.isCompleted) {
        clearInterval(statusCheckInterval);
    }
}, 2000);
```

